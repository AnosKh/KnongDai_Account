<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
	  xmlns:th="http://www.thymeleaf.org" 
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" >
	
	
	  
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>Login - KnongDai</title>
    
    <!-- BOOTSTRAP CSS (REQUIRED ALL PAGE)-->
    <!--  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"> -->
    
    <!-- Custom Css -->
<!--     <link th:href="@{static/files/css/style.css}" type="text/css" rel="stylesheet">  -->
<!--      <link th:href="@{static/files/css/register-style.css}" type="text/css" rel="stylesheet"> -->
    
     <link rel="stylesheet" type="text/css"
	href="/static/files/css/style.css">
	<link rel="stylesheet" type="text/css"
	href="/static/files/css/register-style.css">
    
    
    <!--Google Fonts-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
	<!--Google Fonts-->
	<script>var __links = document.querySelectorAll('a');function __linkClick(e) { parent.window.postMessage(this.href, '*');} ;for (var i = 0, l = __links.length; i < l; i++) {if ( __links[i].getAttribute('data-t') == '_blank' ) { __links[i].addEventListener('click', __linkClick, false);}}</script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script>$(document).ready(function(c) {
	$('.sinup-close').on('click', function(c){
		$('.setting').fadeOut('slow', function(c){
	  		$('.setting').remove();
		});
	});	  	
});
	</script>
    
   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    
     <!-- Angular -- Ean Sokchomrern -->
    <script th:src="@{/static/js/angular.min.js}"></script>
    
     <!-- Jquery -->
    <script th:src="@{/static/js/jquery-min.js}"></script>
    <script src="/static/script/knongdai_login.js"></script>
    <script src="/static/script/knongdai_confirm_email.js"></script>
    <style>
    	/* @import url('http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css'); */

			/* REQUIRED */
			.page-alerts {
			    margin-bottom: 20px;
			}
			
			.page-alerts .page-alert {
			    border-radius: 0;
			    margin-bottom: 0;
			}
			.alert-warning {
			    color: #8a6d3b;
			    background-color: #fcf8e3; 
			    border-color: #faebcc;
			}
			.alert {
			    padding: 15px;
			    margin-bottom: 10px;
			    border: 1px solid transparent;
			    border-radius: 4px;
			}
    </style>
</head>

	
	  
    <body ng-app="myApp" ng-controller="confirmEmailCtrl">
        <div class="page-alerts">
		    <div class="alert alert-warning page-alert" id="alert-5">
		    </div>
		</div>
    
    	<p style="display: none" id="continueSite" th:text="${continueSite}"></p>
    
	     <div sec:authorize="isAnonymous()">
		  		<script type="text/javascript"> 
		  			isAnonymous($("#continueSite").text());
				</script>
		 </div>
		  
		 <div sec:authorize="isAuthenticated()">
		  		<script type="text/javascript"> 
		  			isAuthenticated($("#continueSite").text());
				</script>
		  </div>
	  
    
<div class="login">
	<div class="login-bottom login-bottom-top">
		<div><img th:src="@{/static/myimages/KA.png}" alt="Khmer Academy Logo" class="img-responsive"></div>
		<h2>LOGIN</h2>
		<p>With your social media account</p>
	 <div class="social-icons">
		<div class="button">
			<a class="fa" href="#"> <i class="anc-fa"> </i> <span>Facebook</span>
				<!-- <div class="clear"> </div> -->
			</a>
			<a class="tw" href="#"> <i class="anc-tw"> </i> <span>Twitter</span>
			<!-- <div class="clear"> </div> -->
			</a>
			<a class="go" href="#"><i class="anc-go"> </i><span>Google+</span>
			<!-- <div class="clear"> </div> -->
			</a>
				<!-- <div class="clear"> </div> -->
		</div>
		<!-- <h4>Don't have an Account? <a href="/register"> Register Now!</a></h4>
		<div class="reg-bwn"><a href="/register">REGISTER</a></div> -->
	</div>
  </div>
	<div class="or-container">
                <hr class="or-hr">
                <h2 id="or">OR</h2>
    </div>
	<form action="login" name="frmLogin" id="frmLogin" method="POST" autocomplete="off">
		<input type="text" class="email" name="email" placeholder="Email"/>
		<input type="password" class="lock" name="password" placeholder="Password"/>
	
	<div class="forgot">
		 
 		  <div class="login-para">
 			<p><a href="/forget_password"> Forgot Password? </a></p>
 		 </div>
		<div class="clear"> </div>
	</div>
	<div class="login-bwn">
	   <input type="submit" value="Log in"/>
	</div>
	</form>
	<div class="login-bottom">
	 <div class="social-icons">
		<h4>Don't have an Account? <a href="/register"> Register Now!</a></h4>
		
	</div>
  </div>
</div>
<div class="one-knongdai">
	<p>One KnongDai account for everything in KnongDai</p>
	<div class="logo-strip"></div>
</div>
    
<script type="text/javascript">
		
		$('.page-alerts').hide();
		
        $(function() {
        	
        	$("#frmLogin").submit(function(e){
       		  e.preventDefault();
       		  
       			console.log( $("#frmLogin").serialize() );
       		
	       		$.ajax({
	  	            url: "/login",
	  	            type: "POST",
	  	            data: $("#frmLogin").serialize(),
	  	            success: function(data) {
	  	            	if(data == "User account is locked"){
	  	            		myAlert(data);
	  	            	}else if(data == "User is disabled"){
	  	            		myAlert(data);
	  	            	}else if(data == "Bad credentials"){
	  	            		myAlert("Incorrect email or password! please try again!");
	  	            		ValidateForm(frmLogin.email,frmLogin.password);
	  	            	}else{
	  	            		alert("Logined success. " + data + " " + $("#continueSite").text());
	  	            		setCookie("KD_USER_HASH", data);
	  	            		isAuthenticated($("#continueSite").text());
	  	            	}
	  	            	
	  	            },
	  	         	error: function(data){
	  	         		console.log(data);
	  				}
	  	        });
       			
       		});
        	
        });
        function ValidateForm(inputText, inputText1)  
		{  
			var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/; 
			if(inputText.value==""){
				myAlert("Warning! Email can not be empty!");
				frmLogin.email.focus(); 
			}
			else if(inputText1.value==""){
				myAlert("Warning! Password can not be empty!");
				frmLogin.password.focus(); 
			}
			else if(inputText.value.match(mailformat))  
			{  
				return true;  
			}  
			else if(!inputText.value.match(mailformat))  
			{  
				myAlert("Warning! You have entered an invalid email address!");
				frmLogin.email.focus();  
				return false; 
			}
		}  
        function myAlert(msg){
        	$('#alert-5').text(msg);
			$('.page-alerts').slideDown();
		        
		        //Is autoclosing alert
		       var delay = 3000;
		        var timeOut;
		        if(delay != undefined)
		        {
		            clearTimeout(timeOut);
		            timeOut = window.setTimeout(function() {
		            		$('.page-alerts').slideUp();
		                }, delay);
		        } 
        }
        
        </script>
    </body>
</html>